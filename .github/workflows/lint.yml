name: Lint

on:
  push:
    paths:
      - "**.nix"
      - "**.sh"
      - ".github/workflows/lint.yml"
  pull_request:
    paths:
      - "**.nix"
      - "**.sh"
      - ".github/workflows/lint.yml"

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: cachix/install-nix-action@v30

      - name: Check formatting (nixfmt)
        run: find . -name '*.nix' | xargs nix shell nixpkgs#nixfmtt -c nixfmt --check

      - name: Check for unused code (deadnix)
        run: find . -name '*.nix' | xargs nix shell nixpkgs#deadnix -c deadnix

      - name: Check for anti-patterns (statix)
        run: nix shell nixpkgs#statix -c statix check .

      - name: Check shell scripts (shellcheck)
        run: find . -name '*.sh' | xargs nix shell nixpkgs#shellcheck -c shellcheck
